# AIWF (AI Workflow) ‚Äî –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

## üåê –û–±—â–∞—è –∏–¥–µ—è

**AIWF** ‚Äî —ç—Ç–æ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–π –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –º–Ω–æ–≥–æ—à–∞–≥–æ–≤—ã—Ö LLM-–ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –ø–æ YAML-–∫–æ–Ω—Ñ–∏–≥—É. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º, —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ SDK –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤ (Go, TypeScript, Python –∏ –¥—Ä.) –∏–∑ –æ–¥–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è.

–ö–ª—é—á–µ–≤–∞—è —Ü–µ–ª—å ‚Äî –¥–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–ª–æ–π –º–µ–∂–¥—É –º–æ–¥–µ–ª—è–º–∏ –∏ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π: –≤—Å–µ —Å—Ö–µ–º—ã, –ø—Ä–æ–º–ø—Ç—ã –∏ –≤–æ—Ä–∫—Ñ–ª–æ—É –æ–ø–∏—Å–∞–Ω—ã –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ, SDK —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## üéØ –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏

* –û–±–µ—Å–ø–µ—á–∏—Ç—å **–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º –ø–æ–≤–µ—Ä—Ö LLM**: —Å—Ç—Ä–æ–≥–∏–µ JSON Schema, —Ä–µ—Ç—Ä–∞–∏, –∞–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è.
* –†–∞–∑–¥–µ–ª–∏—Ç—å **–∫–æ–Ω—Ç–µ–Ω—Ç –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**: —Å—Ö–µ–º—ã –∏ –ø—Ä–æ–º–ø—Ç—ã ‚Äî –≤ YAML, –∫–æ–¥ ‚Äî —á–∏—Å—Ç–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞.
* –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å SDK –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤ —Å –µ–¥–∏–Ω—ã–º–∏ –∫–æ–Ω—Ç—Ä–∞–∫—Ç–∞–º–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞–º–∏.

## ‚öôÔ∏è –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

* CLI –æ—Å–Ω–æ–≤–∞–Ω –Ω–∞ `spf13/cobra`: –∫–æ—Ä–Ω–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ `aiwf` —É–∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ–ª–∞–≥–∏ `--config`, `--env`, `--verbose` (`cmd/aiwf/main.go`).
* –ë–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–∞–Ω—Ç–∞–π–º–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –≤ `runtime/go/aiwf/contracts.go` –∏ –ø–æ–∫—Ä—ã—Ç—ã —Ñ–∏–∫—Ç–∏–≤–Ω—ã–º–∏ —Ç–µ—Å—Ç–∞–º–∏.
* –î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª–æ—ë–≤ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤ `ROADMAP.md` –∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å `AGENTS.md`.

## üß± –ë–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã (Go)

### ModelClient

```go
// –ö–ª–∏–µ–Ω—Ç –º–æ–¥–µ–ª–∏ (OpenAI/Anthropic/vLLM –∏ —Ç.–¥.)
type ModelClient interface{
    CallJSONSchema(ctx context.Context, in ModelCall) (raw []byte, usage Tokens, err error)
    CallJSONSchemaStream(ctx context.Context, in ModelCall) (chunks <-chan StreamChunk, usage Tokens, err error)
}
```

### Validator

```go
type Validator interface{
    Validate(schemaRef string, raw []byte) error
    ValidateBusiness(schemaRef string, raw []byte) error // –¥–æ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
}
```

### TemplateEngine

```go
type TemplateEngine interface{
    RenderPrompt(pathOrInline string, data any) (string, error)
    RenderInput(templatePath string, data any) (any, error)
}
```

### ArtifactStore

```go
type ArtifactStore interface{
    Put(ctx context.Context, key string, bytes []byte) error
    Get(ctx context.Context, key string) ([]byte, bool, error)
    Key(workflow, step, itemKey, inputHash string) string
}
```

–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —É–∂–µ –µ—Å—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

- `store.NewFSStore` ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ñ–∞–π–ª–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å TTL –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–æ–π.
- `store.NewS3Store` ‚Äî —É–¥–∞–ª—ë–Ω–Ω–æ–µ S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤.

### RetryPolicy

```go
type RetryPolicy interface{
    ShouldRetry(err error, attempt int) (retry bool, backoff time.Duration)
}
```

## üí¨ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ç–∏–ø—ã

```go
type Tokens struct{
    Prompt     int
    Completion int
    Total      int
}

type Trace struct{
    StepName   string
    Usage      Tokens
    Attempts   int
    Duration   time.Duration // —Ç—Ä–µ–±—É–µ—Ç import "time"
    ArtifactID string
}

type StreamChunk struct{
    Data       []byte
    Done       bool
    Partial    any
    Timestamps map[string]any
}
```

---

## ü§ñ –û–±–æ–±—â—ë–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∞–≥–µ–Ω—Ç–æ–≤, –≤–æ—Ä–∫—Ñ–ª–æ—É –∏ —Ç—Ä–µ–¥–æ–≤

### Agent

```go
type Agent[I any, O any] interface{
    Run(ctx context.Context, in I) (out O, tr *Trace, err error)
    RunStream(ctx context.Context, in I) (chunks <-chan StreamChunk, done <-chan Result[O,*Trace], err error)
}
```

### Workflow

```go
type Workflow[I any, O any] interface{
    Run(ctx context.Context, in I) (out O, tr *Trace, err error)
    RunStep(ctx context.Context, stepName string, payload any) (raw []byte, tr *Trace, err error)
}
```

### Thread

```go
type Thread interface{
    ID() string
    SendUser(ctx context.Context, msg any) (tr *Trace, err error)
    SendToolResult(ctx context.Context, tool string, payload any) (tr *Trace, err error)
    RunUntilIdle(ctx context.Context) (events []any, tr *Trace, err error)
    Snapshot(ctx context.Context) ([]byte, error)
}
```

---

## üìò –†–µ–µ—Å—Ç—Ä —Å—Ö–µ–º –∏ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–æ–≤

```go
type SchemaRegistry interface{
    Get(schemaRef string) ([]byte, error)
    Describe(schemaRef string) (SchemaMeta, error)
}

type SchemaMeta struct{
    Name          string
    Discriminator string
    Enums         map[string][]string
    NullableProps map[string]bool
    OneOf         bool
}

// –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç (–æ–ø—Ä–µ–¥–µ–ª—ë–Ω –≤ YAML)
type AssistantSpec struct{
    Name            string
    Model           string
    SystemPromptRef string
    InputTemplate   string
    OutputSchemaRef string
    Temperature     *float32
    MaxOutputTokens *int
    Tools           []ToolSpec
}

type ToolSpec struct{
    Name string
    InputSchemaRef  string
    OutputSchemaRef string
}

// Scatter-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

type ScatterSpec struct{
    FromExpr    string
    As          string
    Concurrency int
}

// –£–∑–µ–ª DAG

type StepSpec struct{
    Name       string
    Assistant  string
    Needs      []string
    Scatter    *ScatterSpec
    InputBinding map[string]string
}

// –í–æ—Ä–∫—Ñ–ª–æ—É
type WorkflowSpec struct{
    Name  string
    Steps []StepSpec
}
```

---

## üß© Service ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ SDK

```go
type Service interface{
    Agents()   Agents
    Workflows() Workflows
    Threads()  Threads
    Schemas()  SchemaRegistry
}

type Agents interface{
    Premise() PremiseAgent
    Outline() OutlineAgent
    Draft()   DraftAgent
}

type Workflows interface{
    Novel() NovelRunner
    DayPlanner() DayPlannerRunner
}

type Threads interface{
    NewNovelThread(seed any) (Thread, error)
}
```

–ü—Ä–∏–º–µ—Ä —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤ –∏ –≤–æ—Ä–∫—Ñ–ª–æ—É:

```go
type PremiseAgent interface{ Agent[PremiseInput, PremiseOutput] }
type OutlineAgent interface{ Agent[OutlineInput, OutlineOutput] }
type NovelRunner interface{ Workflow[NovelInput, NovelOutput] }
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏–º–µ—Ä)

```go
type Tone string
const (
    ToneDark    Tone = "dark"
    ToneHopeful Tone = "hopeful"
    TonePlayful Tone = "playful"
)

type PremiseOutput struct{
    Logline string   `json:"logline"`
    Themes  []string `json:"themes"`
    Tone    Tone     `json:"tone"`
}

type PremiseInput struct{
    Idea string `json:"idea"`
}
```

---

## üí° –û—à–∏–±–∫–∏ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã

```go
var (
    ErrSchemaViolation = errors.New("aiwf: schema violation")
    ErrBusinessRule    = errors.New("aiwf: business rule failed")
    ErrModelCall       = errors.New("aiwf: model call failed")
    ErrIdempotentHit   = errors.New("aiwf: artifact cache hit")
)

type SchemaError struct{
    SchemaRef string
    Path      string
    Msg       string
}
func (e *SchemaError) Error() string { return fmt.Sprintf("%s %s: %s", e.SchemaRef, e.Path, e.Msg) }
```

---

## üß† –†–æ–ª—å –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ SDK

–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä `aiwf workflow sdk`:

* –ø–∞—Ä—Å–∏—Ç YAML (assistants, workflows, schema_registry);
* –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç SDK-–ø–∞–∫–µ—Ç –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —è–∑—ã–∫–æ–≤;
* —Å–æ–∑–¥–∞—ë—Ç —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã –∏ —Ñ–∞—Å–∞–¥—ã `Service`;
* –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—é, —Ä–µ—Ç—Ä–∞–∏, –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏ –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å.

### –ü—Ä–∏–º–µ—Ä CLI

```bash
aiwf workflow sdk \
  --in internal/workflows/novel.yaml \
  --lang go,ts,py \
  --out ./_generated \
  --module-go github.com/you/aiwf_novel \
  --package-ts @you/aiwf-novel \
  --package-py aiwf-novel
```

---

## üöÄ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è (Go)

```go
svc := aiwfgen.NewService(aiwf.Options{Client: openAI, Store: fsStore, Retry: backoff})
premise, tr, _ := svc.Agents().Premise().Run(ctx, contracts.PremiseInput{Idea: "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤–æ —Å–Ω–µ"})
outline, _, _ := svc.Agents().Outline().Run(ctx, contracts.OutlineInput{Premise: premise})
novel, _, _ := svc.Workflows().Novel().Run(ctx, contracts.NovelInput{Idea: premise.Idea})
```

---

## üìö –†–µ–∑—é–º–µ

**AIWF** ‚Äî —ç—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä SDK –¥–ª—è LLM-–ø–∞–π–ø–ª–∞–π–Ω–æ–≤ –ø–æ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ–º—É –æ–ø–∏—Å–∞–Ω–∏—é:

* –æ–¥–∏–Ω YAML ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ SDK (Go, TS, Python);
* —Å—Ç—Ä–æ–≥–∏–µ JSON Schema ‚Üí —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–Ω—Ç—Ä–∞–∫—Ç—ã;
* —Ñ–∞—Å–∞–¥ `Service` –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–≥–µ–Ω—Ç–∞–º –∏ –≤–æ—Ä–∫—Ñ–ª–æ—É;
* –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã `ModelClient`, `Validator`, `ArtifactStore`, `RetryPolicy` –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ä–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å.

–ü—Ä–∏–º–µ–Ω–∏–º–æ –≤ –ø—Ä–æ–µ–∫—Ç–∞—Ö: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–Ω–∏–≥, –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –¥–Ω—è, –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã —Å DAG-–ª–æ–≥–∏–∫–æ–π, AI-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏ –∞–≥–µ–Ω—Ç—ã —Å –¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –≤—ã—Ö–æ–¥–∞–º–∏.
