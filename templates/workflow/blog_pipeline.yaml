version: 0.3-proposal
# Воркфлоу создания блог-поста

imports:
  - as: shared
    path: ../assistant/common/shared_types.yaml

threads:
  blog_thread:
    provider: openai
    strategy: append
    create: true
    ttl_hours: 24

workflows:
  blog_pipeline:
    input_type: BlogRequest
    output_type: PublishedPost

    steps:
      - name: research
        agent: researcher
        input_type: ResearchInput
        output_type: ResearchOutput

      - name: outline
        agent: outliner
        depends_on: [research]
        input_binding:
          topic: "{{input.topic}}"
          research_data: "{{research.output}}"
        input_type: OutlineInput
        output_type: BlogOutline

      - name: writing
        agent: writer
        depends_on: [outline]
        input_binding:
          outline: "{{outline.output}}"
          style_guide: "{{input.style_guide}}"
        input_type: WritingInput
        output_type: Draft

      - name: editing
        agent: editor
        depends_on: [writing]
        input_binding:
          draft: "{{writing.output}}"
        input_type: EditInput
        output_type: PublishedPost

assistants:
  researcher:
    use: openai
    model: gpt-4o
    thread: { use: blog_thread }
    system_prompt: Research topics thoroughly
    input_type: ResearchInput
    output_type: ResearchOutput

  outliner:
    use: openai
    model: gpt-4o
    thread: { use: blog_thread }
    system_prompt: Create structured outlines
    input_type: OutlineInput
    output_type: BlogOutline

  writer:
    use: openai
    model: gpt-4o
    thread: { use: blog_thread }
    system_prompt: Write engaging content
    input_type: WritingInput
    output_type: Draft

  editor:
    use: openai
    model: gpt-4o-mini
    thread: { use: blog_thread }
    system_prompt: Polish and finalize content
    input_type: EditInput
    output_type: PublishedPost

types:
  BlogRequest:
    topic: string(1..200)
    keywords: string[](1..10)
    target_audience: string
    word_count_target: int(500..5000)
    style_guide: $StyleGuide

  StyleGuide:
    tone: enum(formal, casual, technical, conversational)
    voice: enum(active, passive)
    perspective: enum(first, second, third)

  ResearchInput:
    topic: string
    depth: enum(basic, detailed, comprehensive)

  ResearchOutput:
    key_points: string[]
    sources: $Source[]
    summary: string(100..2000)

  Source:
    title: string
    url: string(url)
    credibility: number(0..1)

  OutlineInput:
    topic: string
    research_data: $ResearchOutput

  BlogOutline:
    title: string
    sections: $Section[]
    estimated_words: int

  Section:
    id: string
    title: string
    points: string[]

  WritingInput:
    outline: $BlogOutline
    style_guide: $StyleGuide

  Draft:
    title: string
    content: string
    word_count: int

  EditInput:
    draft: $Draft

  PublishedPost:
    title: string
    content: string
    excerpt: string(50..300)
    metadata: $PostMetadata

  PostMetadata:
    author: $shared.User
    published_at: datetime
    tags: string[]
    word_count: int
    reading_time_minutes: int