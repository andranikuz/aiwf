# AIWF Blog Workflow – Дорожная карта доработок

Документ обобщает требования из `examples/blog/revisions.md` и текущего состояния `examples/blog/config/sdk.yaml`. Чеклисты синхронизированы с задачами, которые предстоит закрыть в репозитории.

## Контракты и импорты
- [x] Добавить поддержку `imports` и `types` в спеку (`generator/core/spec.go`), чтобы YAML-контракты становились источником JSON Schema.
- [x] На этапе загрузки (`generator/core/loader.go`) резолвить `aiwf://`-ссылки в файлы YAML, кэшировать результаты и валидировать структуру типов.
- [x] Обновить пример `examples/blog/config/*.types.yaml`, чтобы демонстрировать повторное использование схем.

## Генерация структур SDK
- [x] Переписать `generator/backend-go/schema.go`, чтобы для `type: object` формировались именованные структуры, включая вложенные типы и массивы.
- [x] Подготовить тестовые кейсы и снепшоты (`generator/backend-go/testdata`) с проверкой генерируемых структур.
- [ ] Спланировать аналогичное обновление для TS/Python-бэкендов (ссылки на TODO в Roadmap).

## Управление шагами Workflow
- [ ] Расширить спеку и IR (`generator/core/spec.go`, `generator/core/ir.go`) полями `next`, `is_final`, `input_contract_ref` и отражением приоритета `system_prompt_ref`.
- [ ] Обновить пример воркфлоу (`examples/blog/config/sdk.yaml`), чтобы `outline` был финальным шагом или явно имел `next`.
- [ ] Добавить валидацию корректности переходов и соответствия входных контрактов.

## Approval и ревью
- [ ] Описать структуру `approval.review` в спеках и рантайме: `strictness`, `prompt`, `properties`, наследование и dot-path.
- [ ] Реализовать проверку dot-path против JSON Schema, выдавать ошибки при несоответствии.
- [ ] Обновить рантайм (`runtime/go/aiwf`) и тесты, чтобы фиксировать результат ревью (approved/issues/score/edits).

## Переходы `on_approve` / `on_reject`
- [ ] Добавить модели действий (`continue|retry|goto|stop`) в yaml-спеку и IR, валидировать обязательность `step` при `goto`.
- [ ] В рантайме реализовать исполнение этих переходов и приоритет над `next`, учитывая `max_retries` и `require_for_retry`.
- [ ] Покрыть тестами сценарии переходов и ошибок конфигурации.

## Рантайм и провайдеры
- [ ] Обновить `runtime/go/aiwf` контракты и трейсинг под новые структуры шагов и approval.
- [ ] Расширить провайдеры (`providers/openai`, `providers/anthropic`, `providers/local`) поддержкой `system_prompt_ref` и внешних промптов.
- [ ] Синхронизировать артефакт-стор с сохранением ревью и переходов.

## Примеры и тесты
- [ ] Привести `examples/blog/config/sdk.yaml` к финальной версии v0.3 (после внедрения всех изменений).
- [ ] Добавить e2e-тест (validate + генерация) для `examples/blog/config/sdk.yaml`.
- [ ] Заполнить документацию (ссылка в `docs/ROADMAP.md`) и описать процесс миграции конфигураций на новую схему.
