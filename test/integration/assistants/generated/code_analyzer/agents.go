// Code generated by aiwf. DO NOT EDIT.

package code_analyzer_sdk

import (
	"context"
	"encoding/json"
	"fmt"

	"github.com/andranikuz/aiwf/runtime/go/aiwf"
)

// Agents contains all generated agents
type Agents struct {
	CodeAnalyzer *CodeAnalyzerAgent
}

// CodeAnalyzerAgent represents the code_analyzer agent
type CodeAnalyzerAgent struct {
	aiwf.AgentBase
}

// NewCodeAnalyzerAgent creates a new code_analyzer agent
func NewCodeAnalyzerAgent(client aiwf.ModelClient) *CodeAnalyzerAgent {
	return &CodeAnalyzerAgent{
		AgentBase: aiwf.AgentBase{
			Config: aiwf.AgentConfig{
				Name:           "code_analyzer",
				Model:          "gpt-4o",
				SystemPrompt:   `Analyze provided code for quality issues.\nFocus on bugs, security vulnerabilities, and performance.\n`,
				InputTypeName:  "CodeAnalysisRequest",
				OutputTypeName: "AnalysisResult",
				MaxTokens:      2000,
				Temperature:    0.7,
			},
			Client: client,
		},
	}
}

// Run executes the code_analyzer agent
func (a *CodeAnalyzerAgent) Run(ctx context.Context, input CodeAnalysisRequest) (*AnalysisResult, *aiwf.Trace, error) {
	// Validate input
	if err := ValidateCodeAnalysisRequest(&input); err != nil {
		return nil, nil, fmt.Errorf("validation failed: %w", err)
	}

	// Call model
	result, trace, err := a.CallModel(ctx, input, nil)
	if err != nil {
		return nil, trace, err
	}

	// Parse response
	var output AnalysisResult
	if err := json.Unmarshal(result, &output); err != nil {
		return nil, trace, fmt.Errorf("failed to parse response: %w", err)
	}

	return &output, trace, nil
}


